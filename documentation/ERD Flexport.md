# **Entity-Relationship Diagram (ERD)**

Version: 2.0 (Reflects Full Schema)
Date: July 15, 2025
Game: Flexport \- The Video Game

### **1\. Introduction**

This document provides the definitive logical data model for the game, updated to reflect all current database migrations. It serves as the direct blueprint for our Supabase (PostgreSQL) database structure.

### **2\. The Entity-Relationship Diagram**

```mermaid
erDiagram  
    PLAYER {  
        UUID user_id (PK)
        string username  
        int cash  
        int net_worth
        jsonb ai_companion_state
    }

    ASSET {  
        UUID asset_id (PK)
        UUID owner_id (FK)
        string asset_type
        string custom_name
        jsonb stats  
        int maintenance_cost
        UUID assigned_route_id (FK)
        jsonb position
        int rotation
        text port_id
        text status
        int health
    }

    ROUTE {  
        UUID route_id (PK)
        UUID owner_id (FK)
        string origin_port_id
        string destination_port_id
        jsonb performance_data
    }

    SPECIALIST {  
        UUID specialist_id (PK)
        string specialist_type
        jsonb effect_bonuses
        int base_salary
    }

    PLAYER_SPECIALISTS {
        UUID player_id (FK)
        UUID specialist_id (FK)
        date hired_date
    }

    WORLD_STATE {
        string world_id (PK)
        jsonb market_conditions
        jsonb active_disasters
    }

    AUCTION {  
        UUID auction_id (PK)
        string opportunity_type
        jsonb opportunity_details
        int current_bid
        UUID highest_bidder_id (FK)
        timestamp end_time
    }

    MARKET_ITEMS {
        UUID id (PK)
        string name
        string type
        string category
        decimal base_price
        decimal current_price
        int supply
        int demand
    }

    PRICE_HISTORY {
        UUID id (PK)
        UUID item_id (FK)
        decimal price
        timestamp timestamp
    }

    TRANSACTIONS {
        UUID id (PK)
        UUID item_id (FK)
        string type
        int quantity
        decimal total
        UUID player_id (FK)
    }

    AI_COMPANIONS {
        UUID id (PK)
        UUID user_id (FK)
        string name
        string level
        int experience
    }

    AI_SUGGESTIONS {
        UUID id (PK)
        UUID companion_id (FK)
        string type
        string title
        string description
    }

    PLAYER ||--o{ ASSET : owns
    PLAYER ||--o{ ROUTE : creates
    PLAYER ||--o{ PLAYER_SPECIALISTS : hires
    PLAYER ||--o{ AUCTION : bids_on
    PLAYER ||--o{ TRANSACTIONS : performs
    PLAYER ||--|| AI_COMPANIONS : has

    ASSET }o--|| ROUTE : is_assigned_to

    SPECIALIST ||--o{ PLAYER_SPECIALISTS : is_hired_by

    MARKET_ITEMS ||--o{ PRICE_HISTORY : has_history
    MARKET_ITEMS ||--o{ TRANSACTIONS : is_transacted

    AI_COMPANIONS ||--o{ AI_SUGGESTIONS : gives
```

### **3\. Entity Breakdown**

*   **PLAYER:** The central player entity. Linked to `auth.users`.
*   **ASSET:** All player-owned assets (ships, planes, etc.). Now includes columns for on-map placement (`position`, `rotation`, `status`).
*   **ROUTE:** Player-created trade routes.
*   **SPECIALIST / PLAYER_SPECIALISTS:** Defines available specialists and tracks which players have hired them.
*   **WORLD_STATE:** Singleton table holding the global economic state.
*   **AUCTION:** Represents live bidding events for unique items.
*   **MARKET_ITEMS:** Defines all tradable goods, their properties, and current state.
*   **PRICE_HISTORY:** Tracks historical price data for market analysis.
*   **TRANSACTIONS:** Logs all player buy/sell transactions in the market.
*   **AI_COMPANIONS:** Stores the state and progress of each player's AI companion.
*   **AI_SUGGESTIONS:** Logs suggestions generated by the AI for the player.
*   *(Other AI tables like `ai_route_patterns` exist but are omitted for diagram clarity).*